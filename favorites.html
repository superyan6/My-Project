<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music Vault - Favorites</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/mini-player.css">
  <link rel="stylesheet" href="css/common.css">
  <style>
    /* Netease Cloud Music Style */
    :root {
      --primary-color: #d32f2f;
      --secondary-color: #333;
      --background-color: #121212;
      --card-background: #181818;
      --card-hover: #282828;
      --text-primary: #fff;
      --text-secondary: #b3b3b3;
      --border-color: #282828;
      --header-height: 64px;
      --sidebar-width: 240px;
    }

    body {
      background-color: var(--background-color);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

    .app-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar Styles */
    .sidebar {
      width: var(--sidebar-width);
      background-color: #000;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 20px 24px;
    }

    .app-logo {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .sidebar-nav {
      flex: 1;
      padding: 20px 0;
    }

    .nav-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .nav-item {
      margin: 4px 0;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 24px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .nav-link:hover {
      background-color: var(--card-hover);
      color: var(--text-primary);
    }

    .nav-item.active .nav-link {
      background-color: var(--card-hover);
      color: var(--primary-color);
      font-weight: 600;
    }

    .nav-icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 20px 24px;
      border-top: 1px solid var(--border-color);
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .username {
      font-size: 14px;
    }

    /* Main Content Styles */
    .main-content {
      margin-left: var(--sidebar-width);
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    .top-bar {
      height: var(--header-height);
      background-color: rgba(18, 18, 18, 0.95);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      border-bottom: 1px solid var(--border-color);
    }

    .search-container {
      flex: 1;
      max-width: 500px;
    }

    .search-box {
      display: flex;
      align-items: center;
      background-color: var(--card-background);
      border-radius: 20px;
      padding: 0 16px;
      height: 40px;
    }

    .search-icon {
      color: var(--text-secondary);
      margin-right: 8px;
    }

    .search-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      outline: none;
      height: 100%;
    }

    .top-actions {
      display: flex;
      gap: 16px;
    }

    .action-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-color: var(--card-background);
      border: none;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .action-btn:hover {
      background-color: var(--card-hover);
      color: var(--text-primary);
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: 32px;
    }

    /* Section Styles */
    .section {
      margin-bottom: 40px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      margin: 0;
    }

    .section-actions {
      display: flex;
      gap: 16px;
    }

    .section-action-btn {
      background-color: var(--card-background);
      color: var(--text-secondary);
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
    }

    .section-action-btn:hover {
      background-color: var(--card-hover);
      color: var(--text-primary);
    }

    /* Album Header */
    .album-header {
      display: flex;
      gap: 32px;
      padding: 32px;
      background: linear-gradient(135deg, var(--primary-color), #ff5722);
      border-radius: 12px;
      margin-bottom: 32px;
      align-items: center;
    }

    .album-cover {
      width: 200px;
      height: 200px;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .album-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }

    .album-info {
      flex: 1;
    }

    .album-type {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .album-title {
      font-size: 48px;
      font-weight: 800;
      margin-bottom: 16px;
    }

    .album-stats {
      display: flex;
      gap: 32px;
      margin-bottom: 24px;
      color: rgba(255, 255, 255, 0.9);
    }

    .album-actions {
      display: flex;
      gap: 16px;
    }

    .primary-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 24px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.2s ease;
    }

    .primary-btn:hover {
      transform: scale(1.05);
    }

    .secondary-btn {
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .secondary-btn:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    /* Song List */
    .song-list {
      background-color: var(--card-background);
      border-radius: 8px;
      overflow: hidden;
    }

    .song-list-header {
      display: grid;
      grid-template-columns: 50px 1fr 2fr 1fr 80px;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
    }

    .song-list-item {
      display: grid;
      grid-template-columns: 50px 1fr 2fr 1fr 80px;
      padding: 12px 24px;
      border-bottom: 1px solid var(--border-color);
      transition: background-color 0.2s ease;
      align-items: center;
      cursor: pointer;
    }

    .song-list-item:hover {
      background-color: var(--card-hover);
    }

    .song-list-item:nth-child(odd) {
      background-color: rgba(255, 255, 255, 0.02);
    }

    .song-list-item:nth-child(odd):hover {
      background-color: var(--card-hover);
    }

    .song-number {
      color: var(--text-secondary);
      text-align: center;
    }

    .song-list-item:hover .song-number {
      color: var(--primary-color);
    }

    .song-item-cover {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      overflow: hidden;
      margin-right: 12px;
    }

    .song-item-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .song-item-info {
      display: flex;
      align-items: center;
    }

    .song-item-details h4 {
      margin: 0 0 4px 0;
      font-size: 14px;
      font-weight: 600;
    }

    .song-item-details p {
      margin: 0;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .song-album {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .song-duration {
      color: var(--text-secondary);
      font-size: 14px;
      text-align: right;
    }

    /* 排序菜单已移除 */

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 64px 24px;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 24px;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .empty-state-description {
      margin-bottom: 24px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .empty-state-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 24px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .empty-state-btn:hover {
      transform: scale(1.05);
    }

    /* 迷你播放器样式通过外部CSS文件加载 */

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .album-header {
        flex-direction: column;
        text-align: center;
      }
      
      .album-title {
        font-size: 32px;
      }
      
      .song-list-header, .song-list-item {
        grid-template-columns: 50px 1fr 80px;
      }
      
      .song-album {
        display: none;
      }
      
      .player-container {
        flex-direction: column;
        gap: 16px;
      }
      
      .now-playing,
      .volume-control {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="app-logo">My Music Vault</div>
      </div>
      
      <nav class="sidebar-nav">
        <ul class="nav-list">
          <li class="nav-item">
            <a href="index.html" class="nav-link">
              <span class="nav-icon"><i class="fas fa-home"></i></span>
              Home
            </a>
          </li>
          <li class="nav-item active">
            <a href="favorites.html" class="nav-link">
              <span class="nav-icon"><i class="fas fa-heart"></i></span>
              My Favorites
            </a>
          </li>
          <li class="nav-item">
            <a href="recent.html" class="nav-link">
              <span class="nav-icon"><i class="fas fa-history"></i></span>
              Recently Played
            </a>
          </li>
          <li class="nav-item">
            <a href="recommendations.html" class="nav-link">
              <span class="nav-icon"><i class="fas fa-compass"></i></span>
              Recommendations
            </a>
          </li>
          <li class="nav-item">
            <a href="discussion.html" class="nav-link">
              <span class="nav-icon"><i class="fas fa-comments"></i></span>
              Discussion
            </a>
          </li>
          <li class="nav-item">
            <a href="upload.html" class="nav-link">
              <span class="nav-icon"><i class="fas fa-upload"></i></span>
              Upload
            </a>
          </li>
          <!-- Playlists page has been removed -->
        </ul>
      </nav>
      
      <div class="sidebar-footer">
        <div class="user-profile">
          <div class="avatar">JD</div>
          <span class="username">John Doe</span>
        </div>
      </div>
    </aside>
    
    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Top Bar with Search -->
      <div class="top-bar">
        <div class="search-container">
          <div class="search-box">
            <span class="search-icon"><i class="fas fa-search"></i></span>
            <input type="text" class="search-input" placeholder="Search your favorites...">
          </div>
        </div>
        <div class="top-actions">
          <button id="notification-btn" class="action-btn" title="Notifications">
            <i class="fas fa-bell"></i>
            <span id="notification-badge" class="notification-badge" style="display: flex;">3</span>
          </button>
          <button id="settings-btn" class="action-btn" title="Settings">
            <i class="fas fa-cog"></i>
          </button>
        </div>
      </div>
      
      <!-- Content Section -->
      <div class="content">
        <!-- Album Header -->
        <div class="album-header">
          <div class="album-cover">
            <img src="images/picture1.jpg" alt="My Favorites">
          </div>
          <div class="album-info">
            <div class="album-type">Collection</div>
            <h1 class="album-title">My Favorites</h1>
            <div class="album-stats">
              <span>15 songs</span>
              <span>65 minutes</span>
              <span>Updated today</span>
            </div>
            <div class="album-actions">
              <button class="primary-btn">
                <i class="fas fa-play"></i>
                <span>Play All</span>
              </button>
            </div>
          </div>
        </div>
        
        <!-- 搜索结果区域 -->
        <div id="search-results-container" class="song-list" style="display: none;">
          <div class="song-list-header">
            <div class="song-number">#</div>
            <div>Song</div>
            <div>Album</div>
            <div>Date Added</div>
            <div>Duration</div>
          </div>
        </div>
        
        <!-- 原始收藏列表区域 -->
        <div class="song-list" id="favorites-list">
          <div class="song-list-header">
            <div class="song-number">#</div>
            <div>Song</div>
            <div>Album</div>
            <div>Date Added</div>
            <div>Duration</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/Juile.mp3">
            <div class="song-number">1</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/cover1.png" alt="Juile">
              </div>
              <div class="song-item-details">
                <h4>Juile</h4>
                <p>Unknown Artist</p>
              </div>
            </div>
            <div class="song-album">Unknown Album</div>
            <div class="song-album">Today</div>
            <div class="song-duration">3:00</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/in the end.mp3">
            <div class="song-number">2</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/cover2.png" alt="In The End">
              </div>
              <div class="song-item-details">
                <h4>In The End</h4>
                <p>Linkin Park</p>
              </div>
            </div>
            <div class="song-album">Hybrid Theory</div>
            <div class="song-album">Yesterday</div>
            <div class="song-duration">3:37</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/lemon-tree.mp3">
            <div class="song-number">3</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/picture1.jpg" alt="Lemon Tree">
              </div>
              <div class="song-item-details">
                <h4>Lemon Tree</h4>
                <p>Fool's Garden</p>
              </div>
            </div>
            <div class="song-album">Dish of the Day</div>
            <div class="song-album">2 days ago</div>
            <div class="song-duration">3:21</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/nothing on you.mp3">
            <div class="song-number">4</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/cover3.png" alt="nothing on you">
              </div>
              <div class="song-item-details">
                <h4>nothing on you</h4>
                <p>B.o.B, Bruno Mars</p>
              </div>
            </div>
            <div class="song-album">B.o.B Presents: The Adventures of Bobby Ray</div>
            <div class="song-album">1 week ago</div>
            <div class="song-duration">3:43</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/payphone.mp3">
            <div class="song-number">5</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/picture2.jpg" alt="Payphone">
              </div>
              <div class="song-item-details">
                <h4>Payphone</h4>
                <p>Maroon 5, Wiz Khalifa</p>
              </div>
            </div>
            <div class="song-album">Overexposed</div>
            <div class="song-album">1 week ago</div>
            <div class="song-duration">3:51</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/ride it.mp3">
            <div class="song-number">6</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/picture3.jpg" alt="ride it">
              </div>
              <div class="song-item-details">
                <h4>ride it</h4>
                <p>Jay Sean</p>
              </div>
            </div>
            <div class="song-album">My Own Way</div>
            <div class="song-album">2 weeks ago</div>
            <div class="song-duration">3:20</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/that girl.mp3">
            <div class="song-number">7</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/cover1.png" alt="that girl">
              </div>
              <div class="song-item-details">
                <h4>that girl</h4>
                <p>Olly Murs</p>
              </div>
            </div>
            <div class="song-album">24 HRS</div>
            <div class="song-album">2 weeks ago</div>
            <div class="song-duration">3:30</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/we don't talk anymore.mp3">
            <div class="song-number">8</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/cover2.png" alt="we don't talk anymore">
              </div>
              <div class="song-item-details">
                <h4>we don't talk anymore</h4>
                <p>Charlie Puth, Selena Gomez</p>
              </div>
            </div>
            <div class="song-album">Nine Track Mind</div>
            <div class="song-album">1 month ago</div>
            <div class="song-duration">3:37</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/天天.mp3">
            <div class="song-number">9</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/picture1.jpg" alt="天天">
              </div>
              <div class="song-item-details">
                <h4>天天</h4>
                <p>陶喆</p>
              </div>
            </div>
            <div class="song-album">I'm OK</div>
            <div class="song-album">1 month ago</div>
            <div class="song-duration">4:05</div>
          </div>
          
          <div class="song-list-item" data-mp3-path="mp3/茜拉 - 到时说爱我.mp3">
            <div class="song-number">10</div>
            <div class="song-item-info">
              <div class="song-item-cover">
                <img src="images/picture3.jpg" alt="到时说爱我">
              </div>
              <div class="song-item-details">
                <h4>到时说爱我</h4>
                <p>茜拉</p>
              </div>
            </div>
            <div class="song-album">On & On</div>
            <div class="song-album">1 month ago</div>
            <div class="song-duration">3:58</div>
          </div>
        </div>
        
        <!-- 搜索结果区域 -->
        <div class="song-list search-results-section" id="search-results" style="display: none;">
          <div class="song-list-header">
            <div class="song-number">#</div>
            <div>
              <h3 id="search-results-title" style="margin: 0;">搜索结果</h3>
            </div>
            <div>Album</div>
            <div>Date Added</div>
            <div>Duration</div>
          </div>
          
          <div id="search-results-container"></div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- 底部迷你播放器 - 统一使用全局播放器 -->
  <div class="bottom-player">
      <!-- 歌曲信息区域 -->
      <div class="player-info">
          <img id="mini-player-cover" class="mini-player-cover" src="images/picture1.jpg" alt="专辑封面">
          <div class="track-details">
              <div id="mini-player-title" class="mini-player-title">未知歌曲</div>
              <div id="mini-player-artist" class="mini-player-artist">未知艺术家</div>
          </div>
          <button id="favorite-btn" title="收藏">
              <i class="far fa-heart"></i>
          </button>
      </div>
      
      <!-- 播放控制区域 -->
      <div class="player-controls">
          <div class="controls-buttons">
              <button id="shuffle-btn" class="control-btn" title="随机播放">
                  <i class="fas fa-random"></i>
              </button>
              <button id="prev-btn" class="control-btn" title="上一首">
                  <i class="fas fa-step-backward"></i>
              </button>
              <button id="play-pause-btn" class="control-btn" title="播放/暂停">
                  <i class="fas fa-play"></i>
              </button>
              <button id="next-btn" class="control-btn" title="下一首">
                  <i class="fas fa-step-forward"></i>
              </button>
              <button id="repeat-btn" class="control-btn" title="重复播放">
                  <i class="fas fa-redo"></i>
              </button>
          </div>
          <div class="progress-container">
              <span id="current-time">0:00</span>
              <div id="progress-bar">
                  <div id="progress-fill"></div>
              </div>
              <span id="total-time">0:00</span>
          </div>
      </div>
      
      <!-- 音量控制区域 -->
      <div class="player-volume">
          <button id="volume-btn" class="control-btn" title="音量控制">
              <i class="fas fa-volume-up"></i>
          </button>
          <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.8">

      </div>
  </div>
  
  <!-- 播放列表面板 -->
  <div id="playlist-panel">
      <div class="playlist-header">
          <h3>播放列表</h3>
          <button id="close-playlist">
              <i class="fas fa-times"></i>
          </button>
      </div>
      <div id="playlist-items">
          <!-- 播放列表项目将通过JavaScript动态生成 -->
      </div>
  </div>
  
  <!-- Notification Panel -->
  <div id="notification-panel" class="notification-panel">
    <div class="notification-header">
      <h3>Notifications</h3>
      <button id="clear-notifications">Clear All</button>
    </div>
    <div class="notification-list">
      <div class="notification-item unread">
        <div class="notification-content">New album "Summer Vibes" is now available</div>
        <div class="notification-time">Today 12:30</div>
      </div>
      <div class="notification-item unread">
        <div class="notification-content">Your followed artist Jay Park released a new song</div>
        <div class="notification-time">Yesterday 18:45</div>
      </div>
      <div class="notification-item unread">
        <div class="notification-content">Your playlists have been synced</div>
        <div class="notification-time">2 days ago</div>
      </div>
      <div class="notification-item">
        <div class="notification-content">Welcome to Music Player!</div>
        <div class="notification-time">3 days ago</div>
      </div>
    </div>
  </div>
  
  <!-- Settings Panel -->
  <div id="settings-panel" class="settings-panel">
    <div class="settings-header">
      <h3>Settings</h3>
      <button id="close-settings"><i class="fas fa-times"></i></button>
    </div>
    <div class="settings-content">
      <div class="setting-item">
        <div class="setting-label">
          <span>Auto Play</span>
          <label class="toggle-switch">
            <input type="checkbox" id="auto-play-toggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-description">Automatically play next track when current ends</div>
      </div>
      <div class="setting-item">
        <div class="setting-label">
          <span>Notifications</span>
          <label class="toggle-switch">
            <input type="checkbox" id="notification-toggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-description">Receive new album and event notifications</div>
      </div>
      <div class="setting-item">
        <div class="setting-label">
          <span>Default Volume</span>
          <span id="volume-value">80%</span>
        </div>
        <input type="range" id="default-volume-slider" class="setting-slider" min="0" max="100" value="80">
      </div>
      <div class="setting-item">
        <div class="setting-label">
          <span>Audio Quality</span>
          <label class="toggle-switch">
            <input type="checkbox" id="high-quality-toggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-description">High quality playback uses more data</div>
      </div>
      <div class="setting-item">
        <div class="setting-label">
          <span>Dark Mode</span>
          <label class="toggle-switch">
            <input type="checkbox" id="dark-mode-toggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-description">Use dark theme interface</div>
      </div>
    </div>
  </div>
  
  <!-- 音频元素 - 使用单一全局音频元素 -->
  <audio id="audio-player" preload="metadata"></audio>
  
  <script src="js/data-loader.js"></script>
  <script src="js/player.js"></script>
  <script src="js/app.js"></script>
    
    <!-- 搜索功能和播放控制初始化 -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // 统一播放器初始化 - 确保使用全局播放器
        if (!window._globalAudioPlayer) {
          // 如果全局播放器还不存在，尝试创建
          const audioElement = document.getElementById('audio-player');
          if (audioElement && window.Player) {
            window._globalAudioPlayer = new Player(audioElement, []);
          }
        }

        // 获取搜索输入框
        const searchInput = document.querySelector('.search-input');
        
        // 添加输入事件监听
        searchInput.addEventListener('input', function() {
          const query = this.value;
          // 调用App实例的searchTracks方法
          if (window.appInstance) {
            window.appInstance.searchTracks(query);
          }
        });
        
        // 添加键盘事件处理
        searchInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            const query = this.value;
            if (window.appInstance) {
              window.appInstance.searchTracks(query);
            }
          }
        });
        
        // 为歌曲列表项添加点击事件 - 直接播放mp3文件
        const songItems = document.querySelectorAll('.song-list-item');
        const audioPlayer = document.getElementById('audio-player');
        
        // 音量控制功能
        const volumeSlider = document.getElementById('volume-slider');
        const volumeBtn = document.getElementById('volume-btn');
        
        // 设置初始音量
        if (volumeSlider && audioPlayer) {
          audioPlayer.volume = volumeSlider.value;
        }
        
        // 音量滑块事件监听
        if (volumeSlider && audioPlayer) {
          volumeSlider.addEventListener('input', function() {
            audioPlayer.volume = this.value;
            
            // 更新音量图标
            updateVolumeIcon();
          });
        }
        
        // 音量按钮点击事件 - 静音/取消静音
        if (volumeBtn && audioPlayer) {
          volumeBtn.addEventListener('click', function() {
            audioPlayer.muted = !audioPlayer.muted;
            updateVolumeIcon();
            
            // 如果取消静音，确保音量滑块显示正确值
            if (!audioPlayer.muted && volumeSlider) {
              volumeSlider.value = audioPlayer.volume;
            }
          });
        }
        
        // 更新音量图标函数
        function updateVolumeIcon() {
          if (!volumeBtn || !audioPlayer) return;
          
          const icon = volumeBtn.querySelector('i');
          if (audioPlayer.muted || audioPlayer.volume === 0) {
            icon.className = 'fas fa-volume-mute';
          } else if (audioPlayer.volume < 0.5) {
            icon.className = 'fas fa-volume-down';
          } else {
            icon.className = 'fas fa-volume-up';
          }
        }
        
        // 创建一个包含所有歌曲信息的数组
        const allSongs = [];
        songItems.forEach((item, index) => {
          // 获取歌曲信息
          const titleElement = item.querySelector('.song-item-details h4');
          const artistElement = item.querySelector('.song-item-details p');
          const coverElement = item.querySelector('.song-item-cover img');
          const mp3Path = item.getAttribute('data-mp3-path');
          
          if (mp3Path) {
            allSongs.push({
              index: index,
              title: titleElement ? titleElement.textContent : 'Unknown Title',
              artist: artistElement ? artistElement.textContent : 'Unknown Artist',
              cover: coverElement ? coverElement.src : 'images/picture1.jpg',
              path: mp3Path
            });
          }
          
          item.addEventListener('click', function(e) {
            // 防止事件冒泡导致意外行为
            e.preventDefault();
            e.stopPropagation();
            
            // 获取当前歌曲的mp3路径
            const mp3Path = this.getAttribute('data-mp3-path');
            
            if (mp3Path && audioPlayer) {
              // 设置音频源
              audioPlayer.src = mp3Path;
              
              // 清除之前的事件监听器
              const playSuccessHandler = function() {
                // 播放成功
                updatePlayButtonState();
              };
              
              const playErrorHandler = function() {
                // 播放失败，静默处理
                updatePlayButtonState(); // 重置播放按钮
                // 尝试使用lemon-tree.mp3作为备用
                audioPlayer.src = 'mp3/lemon-tree.mp3';
                audioPlayer.load();
                audioPlayer.play();
              };
              
              // 移除之前的事件监听，避免重复绑定
              audioPlayer.removeEventListener('play', playSuccessHandler);
              audioPlayer.removeEventListener('error', playErrorHandler);
              
              // 添加新的事件监听
              audioPlayer.addEventListener('play', playSuccessHandler);
              audioPlayer.addEventListener('error', playErrorHandler);
              
              // 加载并尝试播放
              audioPlayer.load();
              audioPlayer.play().catch(() => {
                  playErrorHandler();
                });
              
              // 更新迷你播放器UI
              updateMiniPlayerUI(this);
            }
            
            // 高亮选中的歌曲
            songItems.forEach(song => song.classList.remove('active'));
            this.classList.add('active');
          });
        });
        
        // 更新迷你播放器UI的函数
        function updateMiniPlayerUI(songItem) {
          const titleElement = songItem.querySelector('.song-item-details h4');
          const artistElement = songItem.querySelector('.song-item-details p');
          const coverElement = songItem.querySelector('.song-item-cover img');
          
          // 更新迷你播放器显示
          if (titleElement) {
            document.getElementById('mini-player-title').textContent = titleElement.textContent;
          }
          if (artistElement) {
            document.getElementById('mini-player-artist').textContent = artistElement.textContent;
          }
          if (coverElement) {
            document.getElementById('mini-player-cover').src = coverElement.src;
            document.getElementById('mini-player-cover').alt = titleElement ? titleElement.textContent : 'Album Cover';
          }
        }
        
        // 更新播放按钮状态的函数
        function updatePlayButtonState() {
          const playPauseBtn = document.getElementById('play-pause-btn');
          if (playPauseBtn && audioPlayer) {
            if (audioPlayer.paused) {
              playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
              playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
          }
        }
        
        // 为播放/暂停按钮添加事件监听
        const playPauseBtn = document.getElementById('play-pause-btn');
        if (playPauseBtn && audioPlayer) {
          playPauseBtn.addEventListener('click', function() {
            if (audioPlayer.paused) {
              audioPlayer.play();
              this.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
              audioPlayer.pause();
              this.innerHTML = '<i class="fas fa-play"></i>';
            }
          });
        }
        
        // 为进度条添加更新功能
        audioPlayer.addEventListener('timeupdate', function() {
          const progressBar = document.getElementById('progress-bar');
          const progressFill = document.getElementById('progress-fill');
          const currentTimeElement = document.getElementById('current-time');
          const totalTimeElement = document.getElementById('total-time');
          
          if (progressBar && progressFill && currentTimeElement && totalTimeElement) {
            const progress = (this.currentTime / this.duration) * 100;
            progressFill.style.width = progress + '%';
            
            // 更新时间显示
            currentTimeElement.textContent = formatTime(this.currentTime);
            totalTimeElement.textContent = formatTime(this.duration);
          }
        });
        
        // 格式化时间的函数
        function formatTime(seconds) {
          if (isNaN(seconds)) return '0:00';
          const minutes = Math.floor(seconds / 60);
          const remainingSeconds = Math.floor(seconds % 60);
          return minutes + ':' + (remainingSeconds < 10 ? '0' : '') + remainingSeconds;
        }
        
        // 为进度条添加点击事件以跳转到特定时间
        const progressBar = document.getElementById('progress-bar');
        if (progressBar && audioPlayer) {
          progressBar.addEventListener('click', function(e) {
            const rect = this.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / this.offsetWidth;
            audioPlayer.currentTime = pos * audioPlayer.duration;
          });
        }
        
        // Play All按钮功能 - 播放所有歌曲
        const playAllButton = document.querySelector('.album-actions .primary-btn');
        if (playAllButton) {
          playAllButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (allSongs.length > 0 && audioPlayer) {
              // 尝试播放第一首歌曲
              audioPlayer.src = allSongs[0].path;
              
              // 设置错误处理
              const playAllErrorHandler = function() {
                // 播放失败，静默处理
                audioPlayer.src = 'mp3/lemon-tree.mp3';
                audioPlayer.load();
                audioPlayer.play();
                updatePlayButtonState();
              };
              
              // 添加错误事件监听
              audioPlayer.removeEventListener('error', playAllErrorHandler);
              audioPlayer.addEventListener('error', playAllErrorHandler);
              
              // 加载并播放
              audioPlayer.load();
              audioPlayer.play().then(() => {
                updatePlayButtonState();
              }).catch(() => {
                playAllErrorHandler();
              });
              
              // 更新UI
              const firstSongItem = songItems[0];
              updateMiniPlayerUI(firstSongItem);
              
              // 高亮第一首歌曲
              songItems.forEach(song => song.classList.remove('active'));
              firstSongItem.classList.add('active');
            }
          });
        }
        
        // 为上一首和下一首按钮添加事件监听
        let currentSongIndex = -1;
        
        // 通用的歌曲播放函数，带错误处理
        function playSongWithErrorHandling(songIndex) {
          if (allSongs.length === 0 || songIndex < 0 || songIndex >= allSongs.length) return;
          
          const targetSong = allSongs[songIndex];
          
          // 设置错误处理
          const errorHandler = function() {
              // 播放失败，静默处理
              
              // 尝试播放下一首或备用歌曲
              const nextIndex = (songIndex + 1) % allSongs.length;
              if (nextIndex !== songIndex) {
                playSongWithErrorHandling(nextIndex);
              } else {
                // 如果只有一首歌，使用备用歌曲
                audioPlayer.src = 'mp3/lemon-tree.mp3';
                audioPlayer.load();
                audioPlayer.play();
              }
            };
          
          // 移除之前的错误监听
          audioPlayer.removeEventListener('error', errorHandler);
          
          // 设置音频源
          audioPlayer.src = targetSong.path;
          
          // 添加错误事件监听
          audioPlayer.addEventListener('error', errorHandler);
          
          // 加载并播放
          audioPlayer.load();
          audioPlayer.play().then(() => {
              updatePlayButtonState();
            }).catch(() => {
              errorHandler();
            });
          
          // 更新UI
          const songItem = songItems[songIndex];
          if (songItem) {
            updateMiniPlayerUI(songItem);
            
            // 高亮选中的歌曲
            songItems.forEach(song => song.classList.remove('active'));
            songItem.classList.add('active');
          }
        }
        
        // 上一首按钮
        const prevBtn = document.getElementById('prev-btn');
        if (prevBtn && audioPlayer) {
          prevBtn.addEventListener('click', function() {
            if (allSongs.length === 0) return;
            
            currentSongIndex = (currentSongIndex - 1 + allSongs.length) % allSongs.length;
            playSongWithErrorHandling(currentSongIndex);
          });
        }
        
        // 下一首按钮
        const nextBtn = document.getElementById('next-btn');
        if (nextBtn && audioPlayer) {
          nextBtn.addEventListener('click', function() {
            if (allSongs.length === 0) return;
            
            currentSongIndex = (currentSongIndex + 1) % allSongs.length;
            playSongWithErrorHandling(currentSongIndex);
          });
        }
        
        // 更新当前歌曲索引的函数
        function updateCurrentSongIndex(mp3Path) {
          // 提取文件名部分进行比较
          const fileName = mp3Path.replace(/^.*[\\\/]/, '');
          const index = allSongs.findIndex(song => {
            return song.path.replace(/^.*[\\\/]/, '') === fileName;
          });
          if (index !== -1) {
            currentSongIndex = index;
          }
        }
        
        // 在歌曲播放时更新当前索引
        audioPlayer.addEventListener('play', function() {
          updateCurrentSongIndex(this.src);
        });
        
        // 循环模式变量（0: 不循环, 1: 单曲循环, 2: 列表循环）
        let repeatMode = 0;
        let isShuffle = false;
        
        // 为循环按钮添加功能
        const repeatBtn = document.getElementById('repeat-btn');
        if (repeatBtn) {
          repeatBtn.addEventListener('click', function() {
            // 切换循环模式
            repeatMode = (repeatMode + 1) % 3;
            
            // 更新按钮样式
            repeatBtn.className = 'control-btn';
            
            if (repeatMode === 1) {
              // 单曲循环
              repeatBtn.classList.add('repeat-one');
              repeatBtn.classList.add('active');
              if (audioPlayer) {
                audioPlayer.loop = true;
              }
            } else if (repeatMode === 2) {
              // 列表循环
              repeatBtn.classList.add('active');
              if (audioPlayer) {
                audioPlayer.loop = false;
              }
            } else {
              // 不循环
              if (audioPlayer) {
                audioPlayer.loop = false;
              }
            }
          });
        }
        
        // 为随机播放按钮添加功能
        const shuffleBtn = document.getElementById('shuffle-btn');
        if (shuffleBtn) {
          shuffleBtn.addEventListener('click', function() {
            isShuffle = !isShuffle;
            shuffleBtn.classList.toggle('active', isShuffle);
            
            if (isShuffle && allSongs.length > 0) {
              // 随机打乱播放顺序
              shuffleSongs();
            }
          });
        }
        
        // 随机打乱歌曲函数
        function shuffleSongs() {
          // 复制当前歌曲数组
          const shuffled = [...allSongs].sort(() => Math.random() - 0.5);
          // 重新排列歌曲DOM元素
          const songListContainer = document.querySelector('.songs-container');
          if (songListContainer) {
            shuffled.forEach(song => songListContainer.appendChild(song));
          }
        }
        
        // 当歌曲播放结束时，根据循环模式处理
        audioPlayer.addEventListener('ended', function() {
          if (repeatMode === 0) {
            // 不循环，停止播放
            updatePlayButtonState();
          } else if (repeatMode === 1) {
            // 单曲循环已经通过audio.loop实现
            audioPlayer.play();
          } else if (repeatMode === 2) {
            // 列表循环，播放下一首
            if (nextBtn) {
              nextBtn.click();
            }
          }
        });
      });
    </script>
    
    <!-- 添加全局播放器同步事件监听 -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // 监听自定义事件以同步播放器状态
        window.addEventListener('tracksUpdated', function(e) {
            if (window.player) {
                window.player.tracks = e.detail.tracks;
                window.player.currentTrackIndex = e.detail.currentTrackIndex;
                if (typeof window.player.updatePlaylist === 'function') {
                    window.player.updatePlaylist();
                }
            }
        });
        
        window.addEventListener('playStateChanged', function(e) {
            if (window.player) {
                window.player.isPlaying = e.detail.isPlaying;
                window.player.currentTrackIndex = e.detail.currentTrackIndex;
                if (typeof window.player.updatePlayPauseButton === 'function') {
                    window.player.updatePlayPauseButton();
                }
            }
        });
        
        window.addEventListener('trackChanged', function(e) {
            if (window.player) {
                window.player.currentTrackIndex = e.detail.trackIndex;
                if (typeof window.player.prepareTrack === 'function') {
                    window.player.prepareTrack(e.detail.trackIndex);
                }
            }
        });
        
        window.addEventListener('playModeChanged', function(e) {
            if (window.player) {
                window.player.isShuffle = e.detail.isShuffle;
                window.player.repeatMode = e.detail.repeatMode;
                if (typeof window.player.updateShuffleButton === 'function') {
                    window.player.updateShuffleButton();
                }
                if (typeof window.player.updateRepeatButton === 'function') {
                    window.player.updateRepeatButton();
                }
            }
        });
      });
    </script>
    
    

    <script src="js/mini-player.js"></script>
    <script>
        // 补丁：为MiniPlayer类添加缺失的bindEvents方法
        MiniPlayer.prototype.bindEvents = function() {
            // 绑定基本事件
            if (this.elements.playPauseBtn) {
                this.elements.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
            }
            if (this.elements.prevBtn) {
                this.elements.prevBtn.addEventListener('click', () => this.playPrevious());
            }
            if (this.elements.nextBtn) {
                this.elements.nextBtn.addEventListener('click', () => this.playNext());
            }
            if (this.elements.shuffleBtn) {
                this.elements.shuffleBtn.addEventListener('click', () => this.toggleShuffle());
            }
            if (this.elements.repeatBtn) {
                this.elements.repeatBtn.addEventListener('click', () => this.toggleRepeat());
            }
            if (this.audio) {
                this.audio.addEventListener('loadedmetadata', () => this.updateTrackInfo());
                this.audio.addEventListener('ended', () => this.handleEnded());
                this.audio.addEventListener('error', (e) => this.handleError(e));
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的handleError方法
        MiniPlayer.prototype.handleError = function(event) {
            console.error('音频播放错误:', event);
        };
        
        // 补丁：为MiniPlayer类添加缺失的updateTrackInfo方法
        MiniPlayer.prototype.updateTrackInfo = function() {
            if (this.tracks[this.currentTrackIndex]) {
                const track = this.tracks[this.currentTrackIndex];
                if (this.elements.currentTitle) {
                    this.elements.currentTitle.textContent = track.title || '';
                }
                if (this.elements.currentArtist) {
                    this.elements.currentArtist.textContent = track.artist || '';
                }
                if (this.elements.currentCover) {
                    this.elements.currentCover.src = track.coverImagePath || 'images/cover1.png';
                }
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的updatePlayPauseButton方法
        MiniPlayer.prototype.updatePlayPauseButton = function() {
            if (this.elements.playPauseBtn) {
                const icon = this.elements.playPauseBtn.querySelector('i');
                if (icon) {
                    icon.className = this.isPlaying ? 'fas fa-pause' : 'fas fa-play';
                }
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的updateShuffleButton方法
        MiniPlayer.prototype.updateShuffleButton = function() {
            if (this.elements.shuffleBtn) {
                this.elements.shuffleBtn.classList.toggle('active', this.isShuffle);
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的updateRepeatButton方法
        MiniPlayer.prototype.updateRepeatButton = function() {
            if (this.elements.repeatBtn) {
                this.elements.repeatBtn.className = 'player-btn';
                if (this.repeatMode === 1) {
                    this.elements.repeatBtn.classList.add('repeat-one');
                    this.elements.repeatBtn.classList.add('active');
                } else if (this.repeatMode === 2) {
                    this.elements.repeatBtn.classList.add('active');
                }
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的updatePlaylist方法
        MiniPlayer.prototype.updatePlaylist = function() {
            if (this.elements.playlistItems) {
                this.elements.playlistItems.innerHTML = '';
                this.tracks.forEach((track, index) => {
                    const li = document.createElement('li');
                    li.className = index === this.currentTrackIndex ? 'active' : '';
                    li.innerHTML = `
                        <div class="track-info">
                            <div class="track-title">${track.title || ''}</div>
                            <div class="track-artist">${track.artist || ''}</div>
                        </div>
                    `;
                    li.addEventListener('click', () => this.playTrackAtIndex(index));
                    this.elements.playlistItems.appendChild(li);
                });
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的updatePlaylistHighlight方法
        MiniPlayer.prototype.updatePlaylistHighlight = function() {
            if (this.elements.playlistItems) {
                const items = this.elements.playlistItems.querySelectorAll('li');
                items.forEach((item, index) => {
                    item.classList.toggle('active', index === this.currentTrackIndex);
                });
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的updateFavoriteButton方法
        MiniPlayer.prototype.updateFavoriteButton = function() {
            // 实现为空，因为收藏功能可能由其他组件处理
        };
        
        // 补丁：为MiniPlayer类添加缺失的addVisualEffects和removeVisualEffects方法
        MiniPlayer.prototype.addVisualEffects = function() {
            if (this.elements.currentCover) {
                this.elements.currentCover.style.animation = 'spin 3s linear infinite';
            }
        };
        
        MiniPlayer.prototype.removeVisualEffects = function() {
            if (this.elements.currentCover) {
                this.elements.currentCover.style.animation = 'none';
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的stopCoverRotation方法
        MiniPlayer.prototype.stopCoverRotation = function() {
            this.removeVisualEffects();
        };
        
        // 补丁：为MiniPlayer类添加缺失的prepareTrack方法
        MiniPlayer.prototype.prepareTrack = function(index) {
            if (this.tracks[index]) {
                const track = this.tracks[index];
                this.currentTrackIndex = index;
                
                if (this.audio) {
                    this.audio.src = track.audioPath || '';
                }
                
                this.updateTrackInfo();
                this.updatePlaylistHighlight();
                
                // 同步到全局播放器
                if (window._globalAudioPlayer === this) {
                    this.broadcastTrackChange(index);
                }
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的savePlayState和restorePlayState方法
        MiniPlayer.prototype.savePlayState = function() {
            try {
                const state = {
                    currentTrackIndex: this.currentTrackIndex,
                    isShuffle: this.isShuffle,
                    repeatMode: this.repeatMode,
                    currentTime: this.audio ? this.audio.currentTime : 0
                };
                localStorage.setItem('miniPlayerState', JSON.stringify(state));
            } catch (error) {
                console.warn('保存播放状态失败:', error);
            }
        };
        
        MiniPlayer.prototype.restorePlayState = function() {
            try {
                const state = JSON.parse(localStorage.getItem('miniPlayerState'));
                if (state) {
                    this.currentTrackIndex = state.currentTrackIndex || 0;
                    this.isShuffle = state.isShuffle || false;
                    this.repeatMode = state.repeatMode || 0;
                    
                    // 延迟恢复当前播放时间，确保音频已加载
                    setTimeout(() => {
                        if (this.audio && state.currentTime && this.tracks[this.currentTrackIndex]) {
                            this.audio.currentTime = state.currentTime;
                        }
                    }, 100);
                }
            } catch (error) {
                console.warn('恢复播放状态失败:', error);
            }
        };
        
        // 补丁：为MiniPlayer类添加缺失的clearTracks和addTrack方法
        MiniPlayer.prototype.clearTracks = function() {
            this.tracks = [];
        };
        
        MiniPlayer.prototype.addTrack = function(track) {
            this.tracks.push(track);
        };
    </script>
    <script>
        // 全局播放器同步事件监听
        window.addEventListener('tracksUpdated', function(event) {
            if (typeof window.player.updatePlaylist === 'function') {
                window.player.tracks = event.detail.tracks || [];
                window.player.currentTrackIndex = event.detail.currentTrackIndex || 0;
                window.player.updatePlaylist();
            }
        });
        
        window.addEventListener('playStateChanged', function(event) {
            if (typeof window.player !== 'undefined') {
                window.player.isPlaying = event.detail.isPlaying || false;
                window.player.currentTrackIndex = event.detail.currentTrackIndex || 0;
                if (typeof window.player.updatePlayPauseButton === 'function') {
                    window.player.updatePlayPauseButton();
                }
                if (typeof window.player.updatePlaylistHighlight === 'function') {
                    window.player.updatePlaylistHighlight();
                }
            }
        });
        
        window.addEventListener('trackChanged', function(event) {
            if (typeof window.player !== 'undefined') {
                window.player.currentTrackIndex = event.detail.trackIndex || 0;
                window.player.tracks = event.detail.track ? [event.detail.track] : [];
                if (typeof window.player.updateTrackInfo === 'function') {
                    window.player.updateTrackInfo();
                }
                if (typeof window.player.updatePlaylistHighlight === 'function') {
                    window.player.updatePlaylistHighlight();
                }
            }
        });
        
        window.addEventListener('playModeChanged', function(event) {
            if (typeof window.player !== 'undefined') {
                window.player.isShuffle = event.detail.isShuffle || false;
                window.player.repeatMode = event.detail.repeatMode || 0;
                if (typeof window.player.updateShuffleButton === 'function') {
                    window.player.updateShuffleButton();
                }
                if (typeof window.player.updateRepeatButton === 'function') {
                    window.player.updateRepeatButton();
                }
            }
        });
    </script>
    
    <!-- 搜索功能实现 -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
          const searchInput = document.querySelector(".search-input");
          if (!searchInput) return;

          searchInput.addEventListener("input", function () {
            const query = this.value.toLowerCase();

            // 针对不同页面的元素类型自动筛选
            const items = document.querySelectorAll(
              ".song-list-item, .track-card, .card, .album-card, .daily-rec-item"
            );

            items.forEach((item) => {
              const text = item.textContent.toLowerCase();
              item.style.display = text.includes(query) ? "" : "none";
            });
          });
        });
    </script>
</html>
